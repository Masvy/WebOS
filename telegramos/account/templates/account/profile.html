{% load static %}

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Profile</title>
    <link
      type="text/css"
      href="{% static 'account/css/style.css' %}"
      rel="stylesheet"
    />
  </head>
  <body>
    <div class="basis">
      <div class="profile--container--log">
        <div class="telegram">Telegram</div>
        <img id="gif1" src="{% static 'account/img/o_light.gif' %}" alt="o" />
        <img id="gif2" src="{% static 'account/img/s_light.gif' %}" alt="s" />
      </div>
      <div class="photo--container">
        <div
          class="photo"
          style="background-image: url('{% static 'account/img/cat.jpg' %}')"
        ></div>
        <div class="grade">
          <p>5.0</p>
        </div>
      </div>
      <div class="name">
        <p>cat_dealereeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee</p>
      </div>
      <div class="deals">
        <p>0 deals</p>
      </div>
      <div class="user--name--container">
        <div class="mail">
          <div class="mail--icon">
            <img src="{% static 'account/img/mail.png' %}" alt="mail" />
          </div>
        </div>
        <div class="wallet">
          <div class="wallet--icon">
            <img src="{% static 'account/img/wallet.png' %}" alt="wallet" />
          </div>
        </div>
        <div class="user--name">
          <p id="username">@YsmanKhamidullin</p>
        </div>
        <div class="like">
          <img src="{% static 'account/img/like.png' %}" alt="like" />
        </div>
      </div>
      <div class="desc--profile--container">
        <div class="scrollable-content">
          <div class="desc--profile">
            <p>
              short description about me, what I do, and what I can do. The cost
              of my services. Write to me for details in private messages, and
              after discussion, I’ll provide you with an exclusive payment lot.
              short description about me, what I do, and what I can do. The cost
              of my services.
            </p>
          </div>
        </div>
      </div>
      <div class="button--container">
        <div class="all--revievs">
          <p>all reviews</p>
        </div>
        <div class="request--payment">
          <p>request payment</p>
        </div>
      </div>
      <div class="experience--container">
        <div class="experience">
          <p>0d on the platform.</p>
        </div>
      </div>
      <div class="theme_container">
        <div class="theme">
          <a href="#" id="themeToggle">Dark</a>
        </div>
      </div>
    </div>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script>
      let tg = window.Telegram.WebApp;
      let userId = tg.initDataUnsafe.user.id;
      let userName_ = tg.initDataUnsafe.user.username;
      userName.textContent = `@${userName_}`;
      const csrf_token = "{{ csrf_token }}";

      document.addEventListener("DOMContentLoaded", function () {
        const themeToggle = document.getElementById("themeToggle");
        const userName = document.getElementById("username");
        const body = document.body;
        const gif1 = document.getElementById("gif1");
        const gif2 = document.getElementById("gif2");

        // Функция для переключения темы
        function toggleTheme() {
          const prefersDarkScheme = window.matchMedia(
            "(prefers-color-scheme: dark)"
          );
          if (prefersDarkScheme.matches) {
            body.classList.add("dark");
            body.classList.remove("light");
            themeToggle.textContent = "Light";
            gif1.src = "{% static 'account/img/o_dark.gif' %}";
            gif2.src = "{% static 'account/img/s_dark.gif' %}";
          } else {
            body.classList.add("light");
            body.classList.remove("dark");
            themeToggle.textContent = "Dark";
            gif1.src = "{% static 'account/img/o_light.gif' %}";
            gif2.src = "{% static 'account/img/s_light.gif' %}";
          }
        }

        // Инициализация темы при загрузке страницы
        toggleTheme();

        fetch("/get_profile/?user_id=" + userId, {
          method: "GET",
          headers: {
            "Content-Type": "application/json",
          }
        })
        .then((response) => response.json())
        .then((data) => {
          userName.textContent = `${data.fields.user_name}`;
        });

        themeToggle.addEventListener("click", function () {
          body.classList.toggle("dark");
          body.classList.toggle("light");
          const currentTheme = body.classList.contains("dark")
            ? "Light"
            : "Dark";
          themeToggle.textContent = `${currentTheme}`;

          if (currentTheme === "Dark") {
            gif1.src = "{% static 'account/img/o_light.gif' %}";
            gif2.src = "{% static 'account/img/s_light.gif' %}";
          } else {
            gif1.src = "{% static 'account/img/o_dark.gif' %}";
            gif2.src = "{% static 'account/img/s_dark.gif' %}";
          }
        });
      });
    </script>
  </body>
</html>
